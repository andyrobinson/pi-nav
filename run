#!/usr/bin/env python
import sys
import subprocess

COMMANDS = ['test','track','hardware','simtrack','showgps', 'simnav']
DEFAULT_COMMAND = 'test'

from src import wiring
from test import sim_wiring

wiring = wiring.Wiring()
sim_wiring = sim_wiring.SimWiring()

if __name__ == '__main__':
    command =  sys.argv[1] if len(sys.argv) > 1 else DEFAULT_COMMAND

    if len(sys.argv) > 2 or command not in COMMANDS:
        sys.exit('Usage: %s [%s]' % (sys.argv[0],'|'.join(COMMANDS)))

    if command == 'test':
        subprocess.call([sys.executable, '-m', 'unittest', 'discover', '-s','test'])

    if command == 'hardware':
        subprocess.call([sys.executable, '-m', 'unittest', 'discover', '-s','hw_integration_test'])

    if command == 'track':
        wiring.tracker().track(30)

    if command == 'simtrack':
        wiring.tracker_simulator().track(3)
        
    if command == 'showgps':
        wiring.showgps()
        
    if command == 'simnav':
        sim_wiring.follower_simulator().follow_route(sim_wiring.manchester_tour())
        
